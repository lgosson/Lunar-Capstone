@model LunarLogic.Models.Contact
@{
    ViewBag.Title = "Services";
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <script src="~/Scripts/modernizr-2.6.2.js"></script>
    <!-- JQuery -->
    <script src="~/Scripts/jquery.js"></script>
    <script src="~/Scripts/jquery-ui.min.js"></script>
    <link href="~/Content/jquery-ui.min.css" rel="stylesheet" />
    <!-- Arbor -->
    <script src="~/Scripts/arbor.js"></script>
    <script src="~/Scripts/arbor-tween.js"></script>
    <script src="~/Scripts/graphics.js"></script>
    <script src="~/Scripts/renderer.js"></script>
    <!-- Sidebar -->
    <script src="~/Scripts/jquery.sidebar.min.js"></script>
    <!-- Styles and Scripts -->
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/Styles.css" rel="stylesheet" />
    <script src="~/Scripts/services.js"></script>
    <script src="~/Scripts/personalplan.js"></script>
    <link rel="shortcut icon" href="~/Images/fav.ico" />
    <title>Lunar Logic Services</title>
</head>
<body>
    <header>
        <div style="margin-left:200px"><a href="http://lunarlogic.com"><img src="~/Images/logo.png" /></a></div>        
    </header>
    <div id="container">
        <canvas id="viewport" ></canvas>
    </div>
    <div id="sidebar">
        <div id="personalplandiv">
            @Html.Partial("_PersonalPlan")
        </div>
        <div id="contactform">
            @Html.Partial("_ContactForm")
        </div>
    </div>
    <script type="text/javascript">
        window.selectedServices = [];
        window.servicesResults = [];

        (function () {

            $.ajax({
                url: '@Url.Action("GetServiceData", "Home")',
                type: "GET",
                contenttype: 'json',
                success: function (result) {
                    graphSetup(result);
                }
            });
        })()

        function graphSetup(result) {
            var sys = arbor.ParticleSystem(50, 500, .01);
            sys.parameters({ gravity: true });
            sys.renderer = Renderer("#viewport");

            for (i = 0; i < result.length; i++) {
                var s = new service();
                s.name = result[i].ID;
                s.label = result[i].Name;
                s.desc = result[i].Description;
                s.selectable = result[i].Selectable;
                s.selected = false;
                //s.hovered = false;
                s.connected = result[i].ConnectedServices;
                s.parent = result[i].ParentService;
                s.color = 'red';
                s.shape = 'dot';
                s.imageurl = result[i].ImageURL;

                window.services.push(s);
            }
            haveSelected(window.services);
            listSetup(window.services);

            sys.renderer.init(sys);
            plan.init(sys.renderer);

            sys.renderer.graphDraw(window.services);
        }

        // Personal plan list setup
        function listSetup(result) {
            for (i = 0; i < result.length; i++) {
                if (result[i].selectable == true) {
                    var id = i + 1;
                    $('#servicelist ul').append('<a href="#"><li class=servicelistitem id=' + id + '>' + result[i].label + '</li></a>');
                }
            }
        }

        // "Have selected" indicator
        function haveSelected(result) {
            $('#haveselected').html("I have chosen " + window.selectedServices.length + " out of " + (result.length - 1) + " services");
            window.servicesResults = result;
        }

        function service() {
            name = '';
            label = '';
            desc = '';
            selectable = false;
            selected = false;
            connected = [];
            parent = '';
            color = 'red';
            shape = 'dot';
            imageurl = '';
        }
    </script>
</body>
</html>